<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>MDB Webpack Starter</title>
  <!-- Favicon -->
  <link rel="icon" href="img/mdb-favicon.ico" type="image/x-icon" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" />
  <!-- Google Fonts Roboto -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" />
  <!-- Main css file -->
  <link rel="stylesheet" href="css/index.min.css" />
  <!-- Custom styles -->
  <style></style>
</head>

<body>
  <!-- Start your project here-->
  <div class="container">
    <form id="form" onsubmit="handleSubmit(event)">
      <div class="addWrapper">
        <input id="title" class="addWrapper__input" oninput="handleChange(event)" type="text"
          placeholder="Tytuł książki"> </input>
        <input id="author" class="addWrapper__input" oninput="handleChange(event)" type="text"
          placeholder="Autor książki">
        </input>
        <label for="type">Rodzaj książki</label>
        <select class="addWrapper__select" name="type" id="type" onchange="handleChange(event)">
          <option value="kryminał">kryminał</option>
          <option value="sci-fi">sci-fi</option>
          <option value="fantasy">fantasy</option>
          <option value="poezja">poezja</option>
          <option value="dramat">dramat</option>
          <option value="nauki ścisłe">nauki ścisłe</option>
        </select>
        <label for="rate"></label>
        <select class="addWrapper__select" name="rate" id="rate" onchange="handleChange(event)">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
          <input type="text" name="addOption" id="addOption">
          <input class="addOption" type="button" value="Dodaj nową kategorię" onclick="handleAddOption()">
        
        <input class="add" type="submit" value="Dodaj"></input>
      </div>
  </div>
  </div>
  </form>
  <button class="sort" onclick="handleSortByTitle()">Sortuj według nazywy</button>
  <button class="sort" onclick="handleSortByAuthor()">Sortuj według autora</button>
  <button class="sort" onclick="handleSortByType()">Sortuj według typu</button>
  <button class="sort" onclick="handleSortByRate()">Sortuj według ważności</button>
  <br>
  <input type="text" name="search" id="search">
  <input class="searchTitle" type="button" value="Szukaj tytułu książki" onclick="handleFindTitle()">
  <input class="searchAuthor" type="button" value="Szukaj autora" onclick="handleFindAuthor()">
  <input class="searchType" type="button" value="Szukaj kategorii" onclick="handleFindType()">
  <input class="searchRate" type="button" value="Szukaj piorytetu" onclick="handleFindRate()">


  

  <div class="empty">
    <div class="fill" draggable="true"><div id="all"></div></div>
  </div>

  <div class="empty">
  </div>


  <p>
    <input type="button" value="Create PDF" 
        id="btPrint" onclick="createPDF()" />
</p>

  <div class="numberOfBooks">
    <p>Liczba wszsykich ksążek:</p>
    <p id="allBooks"></p>
    <p>Liczba kryminałów:</p>
    <p id="crimeBooks"></p>
    <p>Liczba książek sci-fi:</p>
    <p id="sci_fiBooks"></p>
    <p>Liczba książek fantasy:</p>
    <p id="fantasyBooks"></p>
    <p>Liczba poezji:</p>
    <p id="poetryBooks"></p>
    <p>Liczba dramatów:</p>
    <p id="dramaBooks"></p>
    <p>Liczba książek ścisłych:</p>
    <p id="scienceBooks"></p>
  </div>

  <!-- <div class="form-popup" id="myForm">
    <form id="form" class="form-container" onsubmit="handleSubmitChange(event)">
      <div class="addWrapper">
        <input id="title" class="addWrapper__input" oninput="handleChange(event)" type="text"
          placeholder="Tytuł książki"></input>
        <input id="author" class="addWrapper__input" oninput="handleChange(event)" type="text"
          placeholder="Autor książki">
        </input>
        <label for="type">Rodzaj książki</label>
        <select class="addWrapper__select" name="type" id="type" onchange="handleChange(event)">
          <option value="kryminał">kryminał</option>
          <option value="sci-fi">sci-fi</option>
          <option value="fantasy">fantasy</option>
          <option value="poezja">poezja</option>
          <option value="dramat">dramat</option>
          <option value="nauki ścisłe">nauki ścisłe</option>
        </select>
        <label for="rate"></label>
        <select class="addWrapper__select" name="rate" id="rate" onchange="handleChange(event)">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
        <div id="editBtn"></div>
        <input class="btn cancel" type="button" onclick="closeEdit()" value="Zamknij"></input>
      </div>
  </div>
  </div>
  </form>
  </div> -->
  <!-- End your project here-->

</body>
<!-- Main js file -->
<script type="text/javascript" src="js/index.min.js"></script>
<script>
  

  var books = [];
  books=JSON.parse(window.localStorage.getItem('books'));
  let book = {
    type: "kryminał",
    rate: "1",
    id: books.length
  }


  function createPDF() {
        var sTable = document.getElementById('all').innerHTML;

        var style = "<style>";
        style = style + "table {width: 100%;font: 17px Calibri;}";
        style = style + "table, th, td {border: solid 1px #DDD; border-collapse: collapse;";
        style = style + "padding: 2px 3px;text-align: center;}";
        style = style + "</style>";

        // CREATE A WINDOW OBJECT.
        var win = window.open('', '', 'height=700,width=700');

        win.document.write('<html><head>');
        win.document.write('<title>Profile</title>');   // <title> FOR PDF HEADER.
        win.document.write(style);          // ADD STYLE INSIDE THE HEAD TAG.
        win.document.write('</head>');
        win.document.write('<body>');
        win.document.write(sTable);         // THE TABLE CONTENTS INSIDE THE BODY TAG.
        win.document.write('</body></html>');

        win.document.close(); 	// CLOSE THE CURRENT WINDOW.

        win.print();    // PRINT THE CONTENTS.
    }


  const renderFindItmes = (items) => {
    let table = "<table><tr><th>Tytuł</th><th>Autor</th><th>Typ</th><th>Piorytet</th></tr>"
    let tableEnd = "</table>"
    document.getElementById("allBooks").innerHTML = items.length
    var app = document.getElementById("all")
    app.innerHTML = table + items.map((item) => (
      `<tr><td>${item.title}</td> <td>${item.author}</td> <td> ${item.type}</td> <td>${item.rate}</td> <td> <button id="${item.id}" onClick="handleDelete(this.id)" class="delete">Usuń</button> </td> <td> 
        <button id="${item.id}" onClick="openEdit(this.id)" class="change">Zmień dane</button>
        </td> </tr>`
    )).join(" ") + tableEnd
  }


  const handleAddOption = () =>{
  var newOption = document.getElementById('addOption').value
  var x = document.getElementById("type");
  var option = document.createElement("option");
  option.text = newOption;
  x.add(option);
}

  const renderItems = () => {
    let table = "<table><tr><th>Tytuł</th><th>Autor</th><th>Typ</th><th>Piorytet</th></tr>"
    let tableEnd = "</table>"
    document.getElementById("allBooks").innerHTML = books.length
    var app = document.getElementById("all")
    app.innerHTML = table + books.map((item) => (
      `<tr><td>${item.title}</td> <td>${item.author}</td> <td> ${item.type}</td> <td>${item.rate}</td> <td> <button id="${item.id}" onClick="handleDelete(this.id)" class="delete">Usuń</button> </td> <td> 
        <button id="${item.id}" onClick="openEdit(this.id)" class="change">Zmień dane</button>
        </td> </tr>`
    )).join(" ") + tableEnd

    window.localStorage.setItem('books', JSON.stringify(books));

    document.getElementById("crimeBooks").innerHTML = books.filter(({
      type
    }) => (type === 'kryminał')).length;
    document.getElementById("sci_fiBooks").innerHTML = books.filter(({
      type
    }) => (type === 'sci-fi')).length;
    document.getElementById("fantasyBooks").innerHTML = books.filter(({
      type
    }) => (type === 'fantasy')).length;
    document.getElementById("poetryBooks").innerHTML = books.filter(({
      type
    }) => (type === 'poezja')).length;
    document.getElementById("dramaBooks").innerHTML = books.filter(({
      type
    }) => (type === 'dramat')).length;
    document.getElementById("scienceBooks").innerHTML = books.filter(({
      type
    }) => (type === 'nauki ścisłe')).length;
  }

  const handleChange = (event) => {
    event.preventDefault()
    let key = event.target.id
    let value = event.target.value
    book[key] = value
  }
  
  const handleSubmit = (event) => {
    event.preventDefault()
    if (book.title == undefined) {
      alert("Wprowadz tytuł ksiązki")
    } else if (book.author == undefined) {
      alert("Wprowadz autora książki")
    } else {
      books.push(book)
      book = {
        type: "kryminał",
        rate: "1",
        id: books.length
      }
      var frm = document.getElementById('form')
      frm.reset();
      renderItems()
    }
  }
  
  const handleSubmitChange = (event) => {
    event.preventDefault()
  }
  
  const handleDelete = (id) => {
    books = books.filter((el) => el.id != id);
    renderItems()
  }
  
  const handleFindRate = (id) => {
    var filterRate = document.getElementById('search').value
    var filterBooks = books.filter((el) => el.rate == filterRate);
    renderFindItmes(filterBooks)

  }
  
  const handleFindTitle = (id) => {
    var filterTitle = document.getElementById('search').value
    var filterBooks = books.filter((el) => el.title == filterTitle);
    renderFindItmes(filterBooks)
  }
  
  const handleFindAuthor = (id) => {
    var filterAuthor = document.getElementById('search').value
    var filterBooks = books.filter((el) => el.author == filterAuthor);
    renderFindItmes(filterBooks)
  }
  
  const handleFindType = (id) => {
    var filterType = document.getElementById('search').value
    var filterBooks = books.filter((el) => el.type == filterType);
    renderFindItmes(filterBooks)
  }

  const handleSortByTitle = () => {
    books.sort((a, b) => {
      if (a.title < b.title) {
        return -1;
      }
      if (a.title > b.title) {
        return 1;
      }
      return 0;
    });
    renderItems()
  }
  
  const handleSortByAuthor = () => {
    books.sort((a, b) => {
      if (a.author < b.author) {
        return -1;
      }
      if (a.author > b.author) {
        return 1;
      }
      return 0;
    });
    renderItems()
  }
  
  const handleSortByType = () => {
    books.sort((a, b) => {
      if (a.type < b.type) {
        return -1;
      }
      if (a.type > b.type) {
        return 1;
      }
      return 0;
    });
    renderItems()
  }
  
  const handleSortByRate = () => {
    books.sort((a, b) => {
      if (a.rate < b.rate) {
        return -1;
      }
      if (a.rate > b.rate) {
        return 1;
      }
      return 0;
    });
    renderItems()
  }

  const handleEdit = (id) => {
    console.log(id)
    books.forEach((el, index) => {
      if (el.id == id) {
        books[index] = book;
        renderItems()
        closeEdit()
      }
    });
  }

  const openEdit = (id) => {
    document.getElementById("myForm").style.display = "block";
    document.getElementById("editBtn").innerHTML =
      `<button type="submit"  onclick="handleEdit(${id})" class="btn">Zmień dane</button>`
  }
  
  const closeEdit = () => {
    document.getElementById("myForm").style.display = "none";
  }

  renderItems()







const fill = document.querySelector('.fill');
const empties = document.querySelectorAll('.empty');

// Fill listeners
fill.addEventListener('dragstart', dragStart);
fill.addEventListener('dragend', dragEnd);

// Loop through empty boxes and add listeners
for (const empty of empties) {
  empty.addEventListener('dragover', dragOver);
  empty.addEventListener('dragenter', dragEnter);
  empty.addEventListener('dragleave', dragLeave);
  empty.addEventListener('drop', dragDrop);
}

// Drag Functions

function dragStart() {
  this.className += ' hold';
  setTimeout(() => (this.className = 'invisible'), 0);
}

function dragEnd() {
  this.className = 'fill';
}

function dragOver(e) {
  e.preventDefault();
}

function dragEnter(e) {
  e.preventDefault();
  this.className += ' hovered';
}

function dragLeave() {
  this.className = 'empty';
}

function dragDrop() {
  this.className = 'empty';
  renderItems()
  this.append(fill);
}












</script>
<!-- Custom scripts -->
<script type="text/javascript"></script>

</html>